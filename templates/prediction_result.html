<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FarmEazy - Prediction Results</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/results.css') }}"
    />
   <head>
  <body>
    <!-- Header -->
    <div class="header">
      <h1>FarmEazy</h1>
      <div class="nav">
        <a href="{{ url_for('main.index') }}">Home</a>
        <a href="{{ url_for('prediction.prediction_page') }}">New Prediction</a>
        <a href="{{ url_for('classification.classification_page') }}">Classification</a>
        {% if session.user_id %}
        <a href="{{ url_for('main.profile') }}">Profile</a>
        <a href="{{ url_for('auth.logout') }}">Logout</a>
        {% else %}
        <a href="{{ url_for('main.login_page') }}">Login</a>
        {% endif %}
      </div>
    </div>

    <div class="container">
      <div class="results-header">
        <h2>Crop Prediction Results</h2>
        <p class="subtitle">
          AI-powered crop recommendations based on your environmental conditions
        </p>
      </div>

      <!-- Input Summary -->
      <div class="input-summary">
        <h3>üìä Your Environmental Conditions</h3>
        <div class="conditions-grid">
          <div class="condition-item">
            <span class="label">Nitrogen (N)</span>
            <span class="value">{{ prediction_data.input[0] }} units</span>
          </div>
          <div class="condition-item">
            <span class="label">Phosphorus (P)</span>
            <span class="value">{{ prediction_data.input[1] }} units</span>
          </div>
          <div class="condition-item">
            <span class="label">Potassium (K)</span>
            <span class="value">{{ prediction_data.input[2] }} units</span>
          </div>
          <div class="condition-item">
            <span class="label">Temperature</span>
            <span class="value">{{ prediction_data.input[3] }}¬∞C</span>
          </div>
          <div class="condition-item">
            <span class="label">Humidity</span>
            <span class="value">{{ prediction_data.input[4] }}%</span>
          </div>
          <div class="condition-item">
            <span class="label">pH Level</span>
            <span class="value">{{ prediction_data.input[5] }}</span>
          </div>
          <div class="condition-item">
            <span class="label">Rainfall</span>
            <span class="value">{{ prediction_data.input[6] }} mm</span>
          </div>
        </div>
      </div>

      <!-- AI Algorithm Results -->
      <div class="algorithm-results">
        <!-- A* Search Results -->
        {% if prediction_data.results.astar %}
        <div class="algorithm-card astar-results">
          <div class="algorithm-header">
            <h3>üîç A* Search Algorithm Results</h3>
            <div class="algorithm-badge">Optimal Path Finding</div>
          </div>

          {% if prediction_data.results.astar.success %} {% if
          prediction_data.results.astar.perfect_match %}
          <!-- Perfect Match Found -->
          <div class="success-result">
            <div class="result-icon">‚úÖ</div>
            <div class="result-content">
              <h4>Perfect Match Found!</h4>
              <div class="recommended-crop">
                <span class="crop-name"
                  >{{ prediction_data.results.astar.perfect_match.crop }}</span
                >
                <span class="confidence"
                  >Optimal Cost: ${{
                  "%.2f"|format(prediction_data.results.astar.perfect_match.cost)
                  }}</span
                >
              </div>
              <p class="message">{{ prediction_data.results.astar.message }}</p>
            </div>
          </div>
          {% else %}
          <!-- Alternative Recommendations -->
          <div class="alternative-results">
            <div class="result-icon">‚ö†Ô∏è</div>
            <div class="result-content">
              <h4>Alternative Recommendation</h4>
              <p class="message">{{ prediction_data.results.astar.message }}</p>
              {% if prediction_data.results.astar.recommendations %}
              <div class="recommendations-list">
                {% for rec in prediction_data.results.astar.recommendations %}
                <div class="recommendation-item">
                  <span class="crop-name">{{ rec.crop }}</span>
                  <span class="cost-indicator"
                    >Cost: ${{ "%.2f"|format(rec.cost) }}</span
                  >
                </div>
                {% endfor %}
              </div>
              {% endif %}
            </div>
          </div>
          {% endif %} {% else %}
          <!-- Error or No Results -->
          <div class="error-result">
            <div class="result-icon">‚ùå</div>
            <div class="result-content">
              <p>{{ prediction_data.results.astar.message }}</p>
              {% if prediction_data.results.astar.error %}
              <p>
                <strong>Error Details:</strong> {{
                prediction_data.results.astar.error }}
              </p>
              {% endif %}
            </div>
          </div>
          {% endif %}
        </div>
        {% endif %}



        <!-- Greedy Search Results -->
        {% if prediction_data.results.greedy %}
        <div class="algorithm-card Greedy-results">
          <div class="algorithm-header">
            <h3>üîç Greedy Search Algorithm Results</h3>
            <div class="algorithm-badge">Optimal Path Finding</div>
          </div>

          {% if prediction_data.results.greedy.success %} {% if
          prediction_data.results.greedy.perfect_match %}
          <!-- Perfect Match Found -->
          <div class="success-result">
            <div class="result-icon">‚úÖ</div>
            <div class="result-content">
              <h4>Perfect Match Found!</h4>
              <div class="recommended-crop">
                <span class="crop-name"
                  >{{ prediction_data.results.greedy.perfect_match.crop }}</span
                >
                <span class="confidence"
                  >Optimal Cost: ${{
                  "%.2f"|format(prediction_data.results.greedy.perfect_match.cost)
                  }}</span
                >
              </div>
              <p class="message">{{ prediction_data.results.greedy.message }}</p>
            </div>
          </div>
          {% else %}
          <!-- Alternative Recommendations -->
          <div class="alternative-results">
            <div class="result-icon">‚ö†Ô∏è</div>
            <div class="result-content">
              <h4>Alternative Recommendation</h4>
              <p class="message">{{ prediction_data.results.greedy.message }}</p>
              {% if prediction_data.results.greedy.recommendations %}
              <div class="recommendations-list">
                {% for rec in prediction_data.results.greedy.recommendations %}
                <div class="recommendation-item">
                  <span class="crop-name">{{ rec.crop }}</span>
                  <span class="cost-indicator"
                    >Cost: ${{ "%.2f"|format(rec.cost) }}</span
                  >
                </div>
                {% endfor %}
              </div>
              {% endif %}
            </div>
          </div>
          {% endif %} 
          {% else %}
          <!-- Error or No Results -->
          <div class="error-result">
            <div class="result-icon">‚ùå</div>
            <div class="result-content">
              <p>{{ prediction_data.results.greedy.message }}</p>
              {% if prediction_data.results.greedy.error %}
              <p>
                <strong>Error Details:</strong> {{
                prediction_data.results.greedy.error }}
              </p>
              {% endif %}
            </div>
          </div>
          {% endif %}
        </div>
        {% endif %}

        <!-- Genetic Algorithm Results -->
        {% if prediction_data.results.genetic %}
        <div class="algorithm-card genetic-results">
          <div class="algorithm-header">
            <h3>üß¨ Genetic Algorithm Results</h3>
            <div class="algorithm-badge">Evolutionary Optimization</div>
          </div>

          {% if prediction_data.results.genetic.success %}
          <div class="genetic-success">
            <div class="best-crop-section">
              <h4>üèÜ Optimized Recommendation</h4>
              <div class="best-crop">
                <span class="crop-name"
                  >{{ prediction_data.results.genetic.best_crop }}</span
                >
                <div class="fitness-score">
                  <span class="fitness-label">Fitness Score:</span>
                  <div class="fitness-bar">
                    <div
                      class="fitness-fill"
                      style="width: {{ (prediction_data.results.genetic.fitness * 100)|round(1) }}%"
                    ></div>
                  </div>
                  <span class="fitness-percentage"
                    >{{ (prediction_data.results.genetic.fitness * 100)|round(1)
                    }}%</span
                  >
                </div>
              </div>
            </div>

            <!-- Recommended Interventions -->
            <div class="interventions-section">
              <h4>üõ†Ô∏è Recommended Agricultural Interventions</h4>
              <div class="interventions-grid">
                {% for intervention, value in
                prediction_data.results.genetic.interventions.items() %}
                <div class="intervention-item">
                  <span class="intervention-name"
                    >{{ intervention.replace('_', ' ').title() }}</span
                  >
                  <span class="intervention-value">
                    {{ value }} {% if 'fertilizer' in intervention %} kg/ha {%
                    elif intervention == 'irrigation_frequency' %} days {% elif
                    intervention == 'add_organic_matter' %} tonnes/ha {% endif
                    %}
                  </span>
                </div>
                {% endfor %}
              </div>
            </div>

      
          </div>
          {% else %}
          <!-- Error in Genetic Algorithm -->
          <div class="error-result">
            <div class="result-icon">‚ùå</div>
            <div class="result-content">
              <p>
                {{ prediction_data.results.genetic.message or 'Error in genetic
                algorithm processing' }}
              </p>
              {% if prediction_data.results.genetic.error %}
              <p>
                <strong>Error Details:</strong> {{
                prediction_data.results.genetic.error }}
              </p>
              {% endif %}
            </div>
          </div>
          {% endif %}
        </div>
        {% endif %}
      </div>
      

   

<!-- CSP Results -->
{% if prediction_data.results.csp %}
<div class="algorithm-card csp-results">
  <div class="algorithm-header">
    <h3>üß© Constraint Satisfaction Problem (CSP) Results</h3>
    <div class="algorithm-badge">Constraint-Based Optimization</div>
  </div>

  {% if prediction_data.results.csp.success %}
  <div class="success-result">
    <div class="result-icon">‚úÖ</div>
    <div class="result-content">
      <h4>Top Crop Recommendation!</h4>
      <p class="message">{{ prediction_data.results.csp.message }}</p>
      
      {% if prediction_data.results.csp.data %}
      <div class="csp-solution">
        <!-- Top Crop Display -->
        <div class="recommended-crop">
          <span class="crop-name">{{ prediction_data.results.csp.data.crop }}</span>
          <span class="suitability-score">
            {{ prediction_data.results.csp.data.suitability_percentage }}% Match
          </span>
        </div>

        <!-- Matching Conditions -->
        {% if prediction_data.results.csp.data.matching_conditions %}
        <div class="conditions-section">
          <h5>‚úÖ Favorable Conditions:</h5>
          <div class="conditions-list">
            {% for condition in prediction_data.results.csp.data.matching_conditions %}
            <div class="condition-item positive">
              {{ condition }}
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Non-Matching Conditions -->
        {% if prediction_data.results.csp.data.non_matching_conditions %}
        <div class="conditions-section">
          <h5>‚ö†Ô∏è Areas for Improvement:</h5>
          <div class="conditions-list">
            {% for condition in prediction_data.results.csp.data.non_matching_conditions %}
            <div class="condition-item negative">
              {{ condition }}
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Resource Recommendations -->
        {% if prediction_data.results.csp.data.resources %}
        <div class="resources-section">
          <h5>üõ†Ô∏è Recommended Resources:</h5>
          <div class="solution-grid">
            {% for key, value in prediction_data.results.csp.data.resources.items() %}
            {% if value > 0 %}
            <div class="solution-item">
              <span class="solution-label">{{ key.replace('_', ' ').title() }}</span>
              <span class="solution-value">
                {% if 'fertilizer' in key %}
                  {{ value }} kg/ha
                {% elif key == 'irrigation' %}
                  {{ value }} mm
                {% elif key == 'organic_matter' %}
                  {{ value }} tonnes/ha
                {% else %}
                  {{ value }}
                {% endif %}
              </span>
            </div>
            {% endif %}
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Objective Score -->
        {% if prediction_data.results.csp.data.objective_score %}
        <div class="score-section">
          <span class="score-label">Optimization Score:</span>
          <span class="score-value">{{ "%.3f"|format(prediction_data.results.csp.data.objective_score) }}</span>
        </div>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </div>
  {% else %}
  <!-- Error or No Solution -->
  <div class="error-result">
    <div class="result-icon">‚ùå</div>
    <div class="result-content">
      <h4>No Solution Found</h4>
      <p>{{ prediction_data.results.csp.message }}</p>
      {% if prediction_data.results.csp.error %}
      <p>
        <strong>Error Details:</strong> {{ prediction_data.results.csp.error }}
      </p>
      {% endif %}
      <p class="csp-explanation">
        The constraint satisfaction problem could not find a valid assignment 
        that satisfies all agricultural constraints for the given environmental conditions.
      </p>
    </div>
  </div>
  {% endif %}
</div>
{% endif %}

     
      <!-- Action Buttons -->
      <div class="action-buttons">
        <button
          onclick="window.location.href='{{ url_for('prediction.prediction_page') }}'"
          class="btn-primary"
        >
          üîÑ New Prediction
        </button>
        <button
          onclick="window.location.href='{{ url_for('classification.classification_page') }}'"
          class="btn-secondary"
        >
          üéØ Try Classification
        </button>
        
        {% if session.user_id %}
        <button onclick="saveResults()" class="btn-outline">
          üíæ Save to Profile
        </button>
        {% endif %}
      </div>
    </div>

        {% include 'includes/footer.html' %}

    <script>
      function saveResults() {
        // Implementation for saving results to user profile
        alert("Results saved to your profile!");
      }

      // Add smooth scrolling and animations
      document.addEventListener("DOMContentLoaded", function () {
        const cards = document.querySelectorAll(".algorithm-card");
        cards.forEach((card, index) => {
          card.style.animationDelay = `${index * 0.2}s`;
        });
      });
    </script>
  </body>
</html>
